---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Comparison of Avian Clutch Size, Physical Characterists, and Mating Tactics"
subtitle: "https://github.com/jcf55/Fahrenholz_Costes_ENV872_EDA_FinalProject"
author: "Lydie Costes and Jackie Fahrenholz"
fontsize: 12pt
mainfont: Times New Roman

---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Get working directory
getwd()

# Load packages
library(tidyverse)
library(lubridate)
library(GGally)

# Set your ggplot theme
ourtheme <- theme_classic(base_size = 12) +
  theme(axis.text = element_text(color = "black"),
        legend.position = "right")

# Load datasets
birds <- read.csv("../Data/Raw/avian_ssd_jan07.csv")

# Set digit notation
options(scipen = 10)
```

# Rationale and Research Questions

According to the study from which this data was extracted, avian body size and their evolution over time there is much to be debated. Generally, there is agreement about the idea that body size of bird species impacts other characteristics. Because of this, this project intends to explore the correlation between body size of avian species with various measurements and observations in this dataset. First, we ask the question if female tail size predicts clutch size. Tail length has a significant impact on control and agility (Evans 1999). Longer tails increase crash risk as well as reduces the ability to maneuver (Evans 1999). We believe that this may have an overall negative impact on clutch size, as birds with longer tail lengths may be less efficient at collecting food for their young. To follow this analysis, we will explore tail length variation in comparison with methods of display, mating system, and resource sharing systems. 

\newpage

# Dataset Information

Our dataset consists of data that was collected starting in 2005 and was last updated in January of 2007. Data for this collection come from regions that include:

* Western Palearctic
* Neararctic
* Africa
* Australia
* New Zealand
* Antarctica

The complete dataset (represented below by the variable `birds`) includes 41 variables, and represents 146 families. According to the metadata, the majority of this information was gathered from ornithological handbooks, with some data obtained from personal communications with authors who published information on species bird groups. More information on the sources used can be found at: https://esapubs.org/archive/ecol/E088/096/metadata.htm (also in Data/Raw in the .tex file) 

\newpage

# Exploratory Analysis 
```{r explore the data}
#dimensions
dim(birds)
#column names
colnames(birds)
#variable types?
str(birds)
#look at the first few lines
head(birds)

# Should this section go before or after the wrangling below? - I asked this on slack but I'm thinking we should have it after we get the birds.family dataset

```

```{r wrangle the data}
# Convert -999 to NAs and add genus column
birds <- birds %>%
  na_if(., -999) %>%
  separate(Species_name, 
           sep = " ", 
           into = c("Genus", "Sp"), 
           remove = FALSE)

# Subset to columns we are interested in
birds.subset <- birds %>% #without changing the Family variable below I had errors
  select(ï..Family, Species_name, Genus, F_mass, F_bill,
          F_tail,Clutch_size, Mating_System, Display, 
          Resource)

# Alternate option that keeps most columns
# birds.subset <- birds %>%
#   select(-Sp, -English_name, -Subspecies, 
#          -unsexed_mass, -unsexed_mass_N,
#          -Unsexed_wing, -Unsexed_wing_N,
#          -Unsexed_tarsus, -Unsexed_tarsus_N,
#          -Unsexed_bill, -Unsexed_bill_N,
#          -Unsexed_tail, -Unsexed_tail_N,
#          -References)

# I realized all the columns ending in "N" are sample sizes.. so 
# we don't need to include them for analyses but might want to 
# include and sum them (and then maybe exclude genera or families 
# that have a tiny sample size)

# This function allows calculation of mode for categorical variables
Mode <- function(x) {
  ux <- unique(x) 
  ux[which.max(tabulate(match(x, ux)))]
}

# Group by family, average by mean or mode
birds.family <- birds.subset %>%
  group_by(ï..Family) %>% #changed Family name to match what is in data
  summarise(F_mass = mean(F_mass, na.rm = TRUE),
            F_bill = mean(F_bill, na.rm = TRUE),
            F_tail = mean(F_tail, na.rm = TRUE),
            Clutch_size = mean(Clutch_size, na.rm = TRUE),
            Common_Mating_System = Mode(Mating_System),
            Common_Display = Mode(Display),
            Common_Resource = Mode(Resource)) %>%
  filter(!is.na(Clutch_size), !is.na(Common_Mating_System),
         !is.na(Common_Display), !is.na(Common_Resource), 
         !is.na(F_tail), !is.na(F_mass), !is.na(F_bill))
```

\newpage

# Analysis

To test our hypotheses using our subset data `birds.family`, we will conduct a linear regression and an analysis of variance (ANOVA). Our first research question will be answered using a linear regression, while our second will be addressed with an ANOVA. Results will be clearly stated in words, and supplemented using graphing visualizations. 

## Question 1: Does female tail length predict clutch size?
$H_0$ : There is no significant difference between female tail length and clutch size.
$H_A$ : There is a significant difference between female tail length and clutch size.

## Question 2: Does female tail length predict mating approaches?
$H_0$ : There is no significant impact of mating approaches on clutch size
$H_A$ : There is a significant impact of mating approaches on clutch size. 

```{r more_exploration}
# View variable distributions and relationships
ggpairs(birds.subset[,c(1,4:13)])
ggpairs(birds.family)

# Looks like there might be a relationship between tail length and clutch size
# Does female size predict clutch size?
summary(with(birds.subset, lm(Clutch_size ~ F_tail)))
# Yes! But doesn't explain much variation. 
# p < 0.001, R2 = 0.016
#how do we get this plot to not be continuous? change family to chr from int?
ggplot(birds.subset, aes(x = F_tail, y = Clutch_size, color = ï..Family)) +
  geom_point() +
  geom_smooth(method = "lm", se = F, color = "seagreen4")

####### i think that we will only need the stuff above here what do you think?##

# Now weight and clutch size
# Verify that male and female mass are highly correlated
summary(with(birds.subset, lm(M_mass ~ F_mass)))
# They are: p < 0.001, R2 = 0.982. 
# Maybe use female size since females lay eggs

# Does female size predict clutch size?
summary(with(birds.subset, lm(Clutch_size ~ F_mass)))
# Not at all! p = 0.958, R2 < 0.001
ggplot(birds.subset, aes(x = F_mass, y = Clutch_size)) +
  geom_point(aes(color = Family)) +
  xlim(0,12000) 
# I think we have too many families for coloring by family to be meaningful
# Figure out a different way to visualize groupings

```


\newpage

# Summary and Conclusions


\newpage

# References

Evans, M.R. 1999. The consequences of flight for the evolution of tail ornaments in birds. In: Adams, N.J. & Slotow, R.H. (eds) Proc. 22 Int. Ornithol. Congr., Durban: 1823-1843. Johannesburg: BirdLife South Africa.
